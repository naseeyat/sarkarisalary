<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Posting System Demo - Sarkari Salary</title>
    <link rel="stylesheet" href="shared/brutalist-styles.css">
    <link rel="stylesheet" href="css/job-cards.css">
    <style>
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .demo-section {
            background: white;
            border: 3px solid #333;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 6px 6px 0 #000;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .demo-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .quick-post {
            background: #f8f9fa;
            border: 2px solid #333;
            padding: 20px;
        }
        
        .quick-post h3 {
            margin-top: 0;
            color: #333;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
        }
        
        .form-group input, .form-group select {
            padding: 8px;
            border: 2px solid #333;
            border-radius: 0;
            font-family: inherit;
        }
        
        .smart-tags {
            margin-bottom: 15px;
        }
        
        .tag-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .tag-btn {
            padding: 6px 12px;
            border: 2px solid #333;
            background: #fff;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .tag-btn:hover {
            background: #e8f4f8;
        }
        
        .tag-btn.selected {
            background: #3498db;
            color: white;
        }
        
        .auto-detected {
            background: #e8f5e8;
            padding: 10px;
            border: 1px solid #27ae60;
            margin-bottom: 10px;
            font-size: 12px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: 2px solid #333;
            padding: 12px 24px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            border-radius: 0;
        }
        
        .btn:hover {
            background: #0056b3;
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0 #333;
        }
        
        .page-selector {
            margin-bottom: 20px;
        }
        
        .page-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .page-tab {
            padding: 10px 20px;
            background: #ecf0f1;
            border: 2px solid #333;
            cursor: pointer;
            font-weight: bold;
        }
        
        .page-tab.active {
            background: #3498db;
            color: white;
        }
        
        .jobs-display {
            min-height: 300px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>🚀 Automatic Job Posting System Demo</h1>
            <p>Add a job with tags → Watch it appear on relevant pages automatically!</p>
        </div>

        <div class="demo-section">
            <h2>⚡ Quick Job Post</h2>
            <div class="demo-controls">
                <div class="quick-post">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Job Title (will auto-detect tags)</label>
                            <input type="text" id="jobTitle" placeholder="e.g., Railway NTPC, UP Police, SBI PO, Delhi Municipal" 
                                   oninput="autoDetectTags()">
                        </div>
                        <div class="form-group">
                            <label>Posts</label>
                            <input type="number" id="jobPositions" placeholder="1000">
                        </div>
                        <div class="form-group">
                            <label>Last Date</label>
                            <input type="date" id="jobLastDate">
                        </div>
                    </div>
                    
                    <div id="autoDetected" class="auto-detected" style="display:none;">
                        <strong>🤖 Auto-detected:</strong> <span id="detectedInfo"></span>
                    </div>
                    
                    <div class="smart-tags">
                        <label><strong>🎯 Quick Tag Selection (click to toggle):</strong></label>
                        <div class="tag-buttons">
                            <div class="tag-btn" onclick="toggleTag(this, 'all-states')">🇮🇳 All India</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'uttar-pradesh-only')">🏛️ UP Only</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'delhi-only')">🏛️ Delhi Only</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'bihar-only')">🏛️ Bihar Only</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'varanasi-only')">🏢 Varanasi Only</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'railway-category')">🚂 Railway</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'banking-category')">🏦 Banking</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'police-category')">👮 Police</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'psc-category')">🏛️ PSC</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'level-1-jobs')">L1</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'level-2-jobs')">L2</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'level-3-jobs')">L3</div>
                            <div class="tag-btn" onclick="toggleTag(this, 'homepage-trending')">🔥 Trending</div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="quickPost()" style="width: 100%; margin-top: 10px;">
                        ⚡ Post Job (Auto-Distribute)
                    </button>
                </div>
                
                <div id="postPreview" style="display:none; background: #fff; border: 2px solid #27ae60; padding: 15px;">
                    <h3 style="color: #27ae60; margin-top: 0;">✅ Job Posted Successfully!</h3>
                    <div id="previewContent"></div>
                    <small style="color: #666;">Will appear on: <span id="willAppearOn"></span></small>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>📱 Live Page Views</h2>
            <div class="page-selector">
                <div class="page-tabs">
                    <div class="page-tab active" onclick="showPage('homepage')">🏠 Homepage</div>
                    <div class="page-tab" onclick="showPage('uttar-pradesh')">🏛️ UP State</div>
                    <div class="page-tab" onclick="showPage('delhi')">🏛️ Delhi State</div>
                    <div class="page-tab" onclick="showPage('varanasi')">🏢 Varanasi District</div>
                    <div class="page-tab" onclick="showPage('police-jobs')">👮 Police Jobs</div>
                    <div class="page-tab" onclick="showPage('railway-jobs')">🚂 Railway Jobs</div>
                </div>
            </div>
            <div id="jobsDisplay" class="jobs-display">
                <div class="jobs-loading">Loading job postings...</div>
            </div>
        </div>
    </div>

    <script src="js/data-manager.js"></script>
    <script>
        let currentPage = 'homepage';
        let selectedTags = [];
        
        // Wait for data to load then show homepage
        setTimeout(() => {
            showPage('homepage');
        }, 1000);
        
        function autoDetectTags() {
            const title = document.getElementById('jobTitle').value.toLowerCase();
            const detected = document.getElementById('autoDetected');
            const detectedInfo = document.getElementById('detectedInfo');
            
            // Clear previous selections
            document.querySelectorAll('.tag-btn').forEach(btn => btn.classList.remove('selected'));
            selectedTags = [];
            
            let autoTags = [];
            let department = '';
            let category = '';
            
            // Auto-detect based on keywords
            if (title.includes('railway') || title.includes('rrb') || title.includes('ntpc')) {
                autoTags.push('all-states', 'railway-category', 'level-2-jobs');
                department = 'Indian Railways';
                category = 'All India Railway Job';
            } else if (title.includes('sbi') || title.includes('banking') || title.includes('ibps')) {
                autoTags.push('all-states', 'banking-category', 'level-3-jobs');
                department = 'State Bank of India';
                category = 'All India Banking Job';
            } else if (title.includes('up police') || title.includes('uttar pradesh police')) {
                autoTags.push('uttar-pradesh-only', 'police-category', 'level-1-jobs');
                department = 'UP Police';
                category = 'UP State Police Job';
            } else if (title.includes('delhi police')) {
                autoTags.push('delhi-only', 'police-category', 'level-1-jobs');
                department = 'Delhi Police';
                category = 'Delhi Police Job';
            } else if (title.includes('bihar') && title.includes('psc')) {
                autoTags.push('bihar-only', 'psc-category', 'level-2-jobs');
                department = 'Bihar PSC';
                category = 'Bihar State PSC Job';
            } else if (title.includes('varanasi') && title.includes('municipal')) {
                autoTags.push('varanasi-only', 'level-1-jobs');
                department = 'Varanasi Municipal';
                category = 'District Level Municipal Job';
            }
            
            if (autoTags.length > 0) {
                selectedTags = [...autoTags];
                
                // Highlight detected tags
                autoTags.forEach(tag => {
                    const btn = document.querySelector(`[onclick*="${tag}"]`);
                    if (btn) btn.classList.add('selected');
                });
                
                detectedInfo.innerHTML = `${category} → Tags: ${autoTags.join(', ')}`;
                detected.style.display = 'block';
            } else {
                detected.style.display = 'none';
            }
        }
        
        function toggleTag(btn, tag) {
            if (selectedTags.includes(tag)) {
                selectedTags = selectedTags.filter(t => t !== tag);
                btn.classList.remove('selected');
            } else {
                selectedTags.push(tag);
                btn.classList.add('selected');
            }
        }
        
        async function quickPost() {
            const title = document.getElementById('jobTitle').value;
            const positions = document.getElementById('jobPositions').value;
            const lastDate = document.getElementById('jobLastDate').value;
            
            if (!title || !positions) {
                alert('⚠️ Please fill Job Title and Posts');
                return;
            }
            
            // Show loading
            const btn = document.querySelector('button[onclick="quickPost()"]');
            const originalText = btn.textContent;
            btn.textContent = '⏳ Posting...';
            btn.disabled = true;
            
            // Auto-detect department if not detected
            let department = 'Government Department';
            if (title.toLowerCase().includes('railway')) department = 'Indian Railways';
            else if (title.toLowerCase().includes('sbi')) department = 'State Bank of India';
            else if (title.toLowerCase().includes('police')) department = 'Police Department';
            else if (title.toLowerCase().includes('psc')) department = 'Public Service Commission';
            
            const newJob = {
                title: title,
                department: department,
                positions: parseInt(positions),
                lastDate: lastDate || '2024-12-31',
                salaryRange: '₹25,500 - ₹81,100',
                eligibility: 'Graduate',
                examDate: '2024-12-15',
                tags: selectedTags
            };
            
            try {
                // Add job to system (now async)
                const result = await dataManager.addNewJob(newJob);
                
                if (result.success) {
                    // Show preview
                    showPostPreview(newJob, result);
                    
                    // Clear form
                    document.getElementById('jobTitle').value = '';
                    document.getElementById('jobPositions').value = '';
                    document.getElementById('jobLastDate').value = '';
                    document.getElementById('autoDetected').style.display = 'none';
                    document.querySelectorAll('.tag-btn').forEach(btn => btn.classList.remove('selected'));
                    selectedTags = [];
                    
                    // Refresh current page view
                    setTimeout(() => showPage(currentPage), 1000);
                } else {
                    alert('❌ Failed to post job. Please try again.');
                }
            } catch (error) {
                console.error('Error posting job:', error);
                alert('❌ Network error. Please check your connection.');
            } finally {
                // Reset button
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }
        
        function showPostPreview(job, result) {
            const preview = document.getElementById('postPreview');
            const content = document.getElementById('previewContent');
            const willAppear = document.getElementById('willAppearOn');
            
            const storageInfo = result.mode === 'local' ? ' (Demo Mode)' : ' (Live on Server)';
            
            content.innerHTML = `
                <strong>${job.title}</strong> ✅${storageInfo}<br>
                <small>${job.department} • ${job.positions} Posts • Last Date: ${job.lastDate}</small><br>
                <span style="color: #27ae60; font-weight: bold;">Job ID: ${result.jobId}</span>
            `;
            
            willAppear.textContent = result.distributedTo.join(', ');
            preview.style.display = 'block';
            
            // Hide after 4 seconds
            setTimeout(() => {
                preview.style.display = 'none';
            }, 4000);
        }
        
        function showPage(pageType, pageId = null) {
            currentPage = pageType;
            
            // Update active tab
            document.querySelectorAll('.page-tab').forEach(tab => tab.classList.remove('active'));
            event?.target?.classList.add('active') || document.querySelector('.page-tab').classList.add('active');
            
            const display = document.getElementById('jobsDisplay');
            
            if (pageType === 'homepage') {
                const homepageJobs = dataManager.getHomepageJobs();
                display.innerHTML = `
                    <div class="jobs-section">
                        <h2>🔥 Trending Jobs (${homepageJobs.trending?.length || 0})</h2>
                        <div class="jobs-grid">
                            ${homepageJobs.trending?.map(job => dataManager.renderJobCard(job)).join('') || '<p class="no-jobs">No trending jobs</p>'}
                        </div>
                    </div>
                    <div class="jobs-section">
                        <h2>⭐ Featured Jobs (${homepageJobs.featured?.length || 0})</h2>
                        <div class="jobs-grid">
                            ${homepageJobs.featured?.map(job => dataManager.renderJobCard(job)).join('') || '<p class="no-jobs">No featured jobs</p>'}
                        </div>
                    </div>
                `;
            } else {
                let jobs = [];
                let pageTitle = '';
                
                if (['uttar-pradesh', 'delhi'].includes(pageType)) {
                    jobs = dataManager.getJobsForPage('state', pageType);
                    pageTitle = `${pageType.replace('-', ' ').toUpperCase()} State Jobs`;
                } else if (pageType === 'varanasi') {
                    jobs = dataManager.getJobsForPage('district', pageType);
                    pageTitle = 'Varanasi District Jobs';
                } else if (pageType.endsWith('-jobs')) {
                    jobs = dataManager.getJobsForPage('category', pageType);
                    pageTitle = pageType.replace('-', ' ').toUpperCase();
                }
                
                display.innerHTML = `
                    <div class="jobs-section">
                        <h2>${pageTitle} (${jobs.length})</h2>
                        <div class="jobs-grid">
                            ${jobs.map(job => dataManager.renderJobCard(job)).join('') || '<p class="no-jobs">No jobs found for this page</p>'}
                        </div>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>